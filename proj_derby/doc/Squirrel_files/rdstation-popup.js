/**
  * Resultados Digitais - 2016-11-30 10:58:03
  * rdstation-popup - Client Popups generation script with Popups templates.
  * @version v0.4.1
  * @link https://github.com/ResultadosDigitais/rdstation-popups/
  * @license ISC
  */
!function(e,t){"object"==typeof module&&module.exports?module.exports=t():e.JsonHandler=t()}(this,function(){var e=function(e){this.json=e,this.merge=function(e){return this.extend({},e,this.json)},this.extend=function(e){e=e||{};for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var o in n)"object"==typeof n[o]?e[o]=this.extend(e[o],n[o]):e[o]=n[o]}return e}};return e});var RDStationPopupAnalytics=function(){"use strict";function e(){return"function"==typeof ga}function t(){return"undefined"!=typeof _gaq&&"undefined"!=typeof _gat}function n(){return"undefined"!=typeof dataLayer}function o(){return"t0"!==ga.getAll()[0].get("name")}function r(){return e()||t()||n()&&e()&&o()}function i(e,t){this.popupId=e,this.trackCode=t}return i.prototype.sendEvent=function(r){var i;return n()&&e()&&o()?(i=ga.getAll()[0].get("name"),void ga(i+".send","event",{eventCategory:"RD Popups",eventAction:r,eventLabel:this.popupId})):e()?void ga("send","event","RD Popups",r,this.popupId,{nonInteraction:!0}):t()?void _gaq.push(["_trackEvent","RD Popups",r,this.popupId,0,!0]):void("undefined"!=typeof this.trackCode&&this.createGoogleAnalyticsCodeAndSendEvent(r))},i.prototype.createGoogleAnalyticsCodeAndSendEvent=function(e){!function(e,t,n,o,r,i,a){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=o,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create",this.trackCode),ga("send","event","RD Popups",e,this.popupId,{nonInteraction:!0})},i.prototype.sendTrackingEvent=function(e){this.trackCode===!1?console.warn("RD Popup tracking code disabled"):r()?this.sendEvent(e):setTimeout(function(){this.sendEvent(e)}.bind(this),500)},i}(),RdstationPopupData=function(){"use strict";function e(){i(u,"converted",360)}function t(){var e=r(u);return e&&e.match(/converted/)}function n(e){null!==e&&i(c,"viewed",e)}function o(){var e=r(c);return e&&e.match(/viewed/)}function r(e){var t,n,o=document.cookie.split(";");for(e+="=",t=0;t<o.length;t++){for(n=o[t];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e))return n.substring(e.length,n.length)}return null}function i(e,t,n){var o="";if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),o="; expires="+r.toGMTString()}document.cookie=e+"="+t+o+"; path=/"}function a(e){return s=e,u=btoa("rdstation-popup-"+e).replace(/=/g,""),c=btoa("rdstation-popup-"+e+"-viewed").replace(/=/g,""),this}var s,u,c;return{init:a,readCookie:r,setConvertedPopup:e,hasConvertedPopup:t,setViewedPopup:n,hasViewedPopup:o}}(),RdstationPopupUrl=function(){"use strict";function e(e){if(0===e.length)return"*";if(1===e.length)return e[0];u=document.createElement("a");for(var n=[],o=0;o<e.length;o++)u.href=e[o],n.push(u.search);var o=t(n,window.location.search);return e[o]}function t(e,t){var n=e.indexOf(t);if(n!==-1)return n;for(var o=[],r=0;r<e.length;r++)e[r].split("&").length===t.split("&").length&&o.push(r);if(o.length>0)return o[0];for(var i=0,r=0;r<e.length;r++)i=e[r].slice("&").length>e[i].slice("&").length?r:i;return i}function n(e){return u=document.createElement("a"),u.href=e,o()&&r()&&i()}function o(){var e=window.location.hostname.replace("www.","");return e===u.hostname}function r(){var e=a(window.location.pathname,"/"),t=a(s(u.pathname,"/"),"/");return t===e}function i(){if(""===u.search)return!0;for(var e=u.search.replace("?",""),t=e.split("&"),n=window.location.search.replace("?",""),o=n.split("&"),r=0;r<t.length;r++)if(o.indexOf(t[r])===-1)return!1;return!0}function a(e,t){return e.substr(e.length-1)===t?e.slice(0,-1):e}function s(e,t){return e.substr(0,1)===t?e:t+e}var u;return{validate:n,priorityUrlSearch:t,priorityUrl:e}}();"undefined"!=typeof module&&module.hasOwnProperty("exports")&&(module.exports=RdstationPopupUrl);var RdstationPopup=function(){"use strict";function e(e){return e.replace(/pop-me-voy/gi,"pop-me-voy"+k)}function t(e){q&&new RDStationPopupAnalytics(S.identifier,q).sendTrackingEvent(e)}function n(){var e="undefined"!=typeof S.show_frequency?S.show_frequency:null;void 0!==_||L.hasConvertedPopup()||L.hasViewedPopup()||C.classList.contains("show")||(C.classList.add("show"),L.setViewedPopup(e),t("Viewed"))}function o(e){e.screenY<=250&&n()}function r(){C.classList.remove("show"),document.body.removeEventListener("mouseleave",o)}function i(){r(),t("Closed")}function a(){var e,t=C.getElementsByClassName("js-close-popup");for(e=0;e<t.length;++e)t[e].addEventListener("click",i,!1)}function s(){"exit_intent"===S.trigger&&document.body.addEventListener("mouseleave",o)}function u(){var e,t,n,o={};for(j.getElementsByClassName("js-submit-popup")[0].disabled=!0,e=0,t=j.length;e<t;++e)n=j[e],n.name&&(o[n.name]=n.value);return o.token_rdstation=k,o.identificador=S.identifier,o}function c(e,t){var n=new XMLHttpRequest;n&&(n.open("GET",e,!0),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?t(n):console.warn("Failed to get options."))},n.send(null))}function p(){L.setConvertedPopup(),S.redirect_to&&(window.location.href=S.redirect_to),r()}function d(e,t){var n=new XMLHttpRequest;n&&(n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/json; charset=UTF-8"),n.send(JSON.stringify(t)),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?p():console.warn("Failed to reach RD Station."))})}function l(e){var t,n;t=C.querySelector(".popup-form .form-status"),t.classList.remove("success","error"),t.classList.add(e.type),n=document.createElement("p"),n.innerHTML=e.text,t.innerHTML="",t.appendChild(n),clearTimeout(R),R=setTimeout(function(){t.removeChild(n)},3e3)}function f(){var e,n,o;j=C.querySelector(".popup-form"),j.onsubmit=function(r){for(r.preventDefault(),e=0,n=j.elements.length;e<n;e++)if(o=j.elements.item(e),!o.validity.valid)return l({type:"error",text:o.validationMessage}),o.focus(),void t("Validation Failed");d(D,u())}}function v(){var e=C.querySelector("input[name=traffic_source]"),t=C.querySelector("input[name=c_utmz]"),n=C.querySelector("input[name=client_id]"),o="";try{o=JSON.parse(decodeURIComponent(L.readCookie("rdtrk"))).id}catch(e){}e.value=L.readCookie("__trf.src"),t.value=L.readCookie("__utmz"),n.value=o}function m(){var t=["https://s3.amazonaws.com",O,"templates",S.template,"template.html"].join("/");c(t,function(t){var o=e(t.responseText);document.body.insertAdjacentHTML("afterbegin",templateEngine(o,S.values)),C=document.getElementById("pop-me-voy"+k),s(),a(),void 0===_?(f(),v()):n()})}function h(){m()}function g(e,t){var n=["https://s3.amazonaws.com",O,"templates",e.template,"config.json"].join("/");c(n,function(e){var n=JSON.parse(e.responseText);t(n)})}function y(e){g(e,function(t){var n=new JsonHandler(e.values).merge(t);S=e,S.values=n,h()})}function w(e){var t=Object.keys(e.paths).filter(RdstationPopupUrl.validate),n=RdstationPopupUrl.priorityUrl(t),o=e.paths[n];if(void 0!==o){var r="number"==typeof o?o:o.center;L=RdstationPopupData.init(r),y(e.popups[r])}}function b(){return document.querySelectorAll('[data-field-name*="landing_page"]').length>0&&document.querySelectorAll('[data-editable="true"]').length>0}function x(e){var t=["https://s3.amazonaws.com",O,"templates",e].join("/");c(t+"/config.json",function(e){var n=JSON.parse(e.responseText);c(t+"/template.html",function(e){var t=e.responseText;document.body.insertAdjacentHTML("afterbegin",templateEngine(t,n)),C=document.getElementById("pop-me-voy"),C.classList.add("show")})}),_=!0}function E(e){return e=JSON.parse(e),"null"===e||null===e||!Object.keys(e).length}function P(e,t,n){if(!b()){var o;k=e,T=t,q=n,o=["https://s3.amazonaws.com",O,"popups",T,"popups_config.json"].join("/"),c(o,function(e){E(e.responseText)||w(JSON.parse(e.responseText))})}}var j,C,S,T,k,R,_,L,q,A="production",O={dev:"rdstation-popups-dev",staging:"rdstation-popups-staging",production:"rdstation-popups"}[A||"dev"],D={dev:"http://localhost:3000/api/1.3/conversions",staging:"https://staging.rdstation.com.br/api/1.3/conversions",production:"https://www.rdstation.com.br/api/1.3/conversions"}[A||"dev"];return{init:P,templatePreview:x}}();!function(e,t){"function"==typeof define&&define.amd?define(["templateEngine"],t):"object"==typeof module&&module.exports?module.exports=t():e.templateEngine=t()}(this,function(){function e(e,t){function n(e,t){return s+=t?e.match(a)?e+"\n":"r.push("+e+");\n":""!==e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",n}for(var o,r,i=/{{(.+?)}}/g,a=/(^( )?(var[\s]|if[\s(]|else[\s(]|switch[\s(]|for[\s(]|case[\s(]|break|{|}|;))(.*)?/g,s="with(obj) { var r=[];\n",u=0;r=i.exec(e);)n(e.slice(u,r.index))(r[1],!0),u=r.index+r[0].length;n(e.substr(u,e.length-u)),s=(s+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{o=new Function("obj",s).apply(t,[t])}catch(e){console.error("'"+e.message+"'"," in \n\nCode:\n",s,"\n")}return o}return e});